window.spider=function(){var executeOnReady={},registry={},settings={basePath:"/",concat:false,local:false},config=function(newSettings){for(var option in newSettings)settings[option]=newSettings[option]},define=function(module,constructor){if(typeof registry[module]==="undefined"){registry[module]={importedBy:[],ready:false}}var dependencies=findDependencies(constructor);registry[module].constructor=constructor;registry[module].dependencies=dependencies;if(dependencies.length===0)registry[module].ready=true;for(var i=0;i<dependencies.length;i++){if(typeof registry[dependencies[i]]==="undefined"){registry[dependencies[i]]={importedBy:[],ready:false};load(dependencies[i])}registry[dependencies[i]].importedBy.push(module)}propagateReadiness(module)},execute=function(module){if(module in registry&&registry[module].ready)return registry[module].constructor();executeOnReady[module]=true;load(module)},fetch=function(module){if(typeof registry[module].obj==="undefined")registry[module].obj=registry[module].constructor();return registry[module].obj},findDependencies=function(constructor){var match,dependencies=[],constructorString=constructor.toString(),regex=/spider\.fetch\('([\w\/]*)'\)/g;while(match=regex.exec(constructorString))dependencies.push(match[1]);return dependencies},load=function(module){if(settings.concat)return;var script=document.createElement("script");script.src=(settings.local?"":settings.basePath)+module+".js";script.addEventListener("load",function(){script.parentNode.removeChild(script)});document.getElementsByTagName("head")[0].appendChild(script)},propagateReadiness=function(module){if(!registry[module].ready)registry[module].ready=testReadiness(module);if(registry[module].ready){if(executeOnReady[module]){delete executeOnReady[module];registry[module].constructor()}else{var requestingModules=registry[module].importedBy;for(var i=0;i<requestingModules.length;i++)propagateReadiness(requestingModules[i])}}},testReadiness=function(module){var dependencies=registry[module].dependencies;for(var i=0;i<dependencies.length;i++)if(!registry[dependencies[i]].ready)return false;return true};return{config:config,define:define,execute:execute,fetch:fetch}}();